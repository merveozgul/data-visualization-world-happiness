---
title: "first_script"
author: "merve ozgul"
date: "1/31/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


*Analysis on World Happiness Dataset *

In this project I will analyze World Happiness dataset, which has 155 countries and different attributes. I took the dataset from Kaggle: https://www.kaggle.com/unsdsn/world-happiness/home



#1) Loading the Dataset & Initial Exploration of Dataset

I use "Import Dataset" at the Global Environment to load the dataset. Then I convert the dataset to dataframe. 

```{r}
#library(readr)
#X2015 <- read_csv("~/Desktop/world-happiness-report/2015.csv")
happy_2015 <- as.data.frame(X2015)
```

I use some functions to have a glance at the dataset and understand it. I would like to check the column(attribute) names initially, to see if I should make any changes before starting to further explore the dataset. I like to change the names, optimize them in a meaningful and shorter manner. This way it makes it easier for me to call column names, in the future.
```{r}
#Viewing column names
names(happy_2015)
```
It would be better to change all column names in a way that they won't include white space in their names. It is also good to note their original name in the metadata, in case the attribute name we create is not clear enough.

 [1] "Country"                       "Region"                       
 [3] "Happiness Rank"                "Happiness Score"              
 [5] "Standard Error"                "Economy (GDP per Capita)"     
 [7] "Family"                        "Health (Life Expectancy)"     
 [9] "Freedom"                       "Trust (Government Corruption)"
[11] "Generosity"                    "Dystopia Residual"   

```{r}
#Changing column names
names(happy_2015) <- c("country", "region", "happiness_rank", "happiness_score", "std_error", "gdp_per_cpt", "family", "life_exp", "freedom", "trust_corruption", "generosity", "dystopia_residual")
```

#Characteristics of the Dataset
Now we can start with our analysis: 

```{r}
head(happy_2015)

#Viewing stats about each attribute
summary(happy_2015)

#structure
str(happy_2015)

#missing values 
sum(is.na(happy_2015))

```

Our data seems pretty much clean. Additionally, there are no missing values in our dataset, which will accelerate our analysis. We don't have to put any time to handle the missing values. 

I also want to count how many countries and regions we have: 
```{r}
#Number of countries in our dataset
length(unique(happy_2015$country))

#Number of regions
length(unique(happy_2015$region))
```

Since we have 10 regions and 158 countries, we can subset our dataset to regions and look at the distributions. By analyzing regions separetely, we can find out about their characteristics.
But before zooming into the regions(subsetting), we can have a look at the world in general.

#Identifying Happiest and Unhappiest Countries and Regions

#Happiness Rank 
Rank=1 indicates the happiest country in the world.Keeping that in the mind we can have a look the first 10 and last ten countries in the list.
Top ten happiest countries:
```{r}
head(happy_2015, 10)
```
The happiest counties are mostly in Western Europe. 

Least ten happiest countries:
```{r}
tail(happy_2015, 10)
```
Majority of the unhappiest countries are located in Sub-Saharan Africa. Countries which are not located in Sub-Saharan Africa and still included in this list are Syria and Afghanistan, which is not suprising if we consider the ongoing war and terrorism in those countries.

Since happiness rank is based on happiness score, I would like to analyze the average happiness score among regions and then try to focus on the characteristics of the happiest and unhappiest regions.

#Happiness Score based on Region
```{r}
library(dplyr)
library(tidyr)
library(plotly)

#table with average happiness per region
avg_happiness_region <-happy_2015 %>%
        group_by(region) %>%          
        summarise(avg_happiness = mean(happiness_score, round(1)))


#Plotting the average happiness scores to compare regions
p_avg_happiness_region <- plot_ly(avg_happiness_region, x = ~region, y = ~avg_happiness, type = 'bar', name = 'Average Happiness') %>% 
  #add_trace(y = ~mean(happy_2015_copy$happiness_score), name = 'world')%>%
  layout(title="Average Happiness per Region in 2015")
show(p_avg_happiness_region)

```
Top 3 happiest regions based on average happiness score are: 
 -Australia & New Zealand
 -North America 
 -Western Europe

It is important to note that both of the first two regions include only 2 countries and Western Europe has 21 countries. Additionally all of these regions include countries with developed economies.

The unhappiest region is Sub-Saharan Africa, which includes 40 different countries.

#What factors have strong relationship with Happiness? 
Now we can create a correlogram to analyze the relationships. To do that we need only numeric columns.
```{r}
names(happy_2015_copy)
num_hap <- happy_2015_copy[, c("happiness_rank", "happiness_score", "std_error", "gdp_per_cpt", "family", "life_exp", "freedom", "trust_corruption", "generosity", "dystopia_residual")]
```

I like to use rquery to create a heatmap and see the correlations, as it is very efficient.
```{r}
library(corrplot)
source("http://www.sthda.com/upload/rquery_cormat.r")
rquery.cormat(num_hap)
```

#Strong Positive Correlations(corr>+0.7) with Happiness Score
*Gdp Per Capita
```{r}
cor(happy_2015$happiness_score, happy_2015$gdp_per_cpt)
```
Countries that have higher gdp per capita seems to be happier. Since higher gdp per capita indicates a better standard of living for a country, it makes sense.

*Family
```{r}
cor(happy_2015$happiness_score, happy_2015$family)
```
Although the explanation family attribute is not clear in the metadata, family contributes to happier people.


*Life Expectancy
```{r}
cor(happy_2015$happiness_score, happy_2015$life_exp)
```
Life expectancy, probably the average years of life contributes to happier positively.


*Insight: Freedom doesn't have a great influence on the happiness 
```{r}
cor(happy_2015$happiness_score, happy_2015$freedom)
```

#Happiest Regions vs. Unhappiest Region
#Subsetting our dataset
Now we have subsetted the dataset into the regions we can do analysis on each region.
```{r}
unique(happy_2015$region)
#############################
#Happiest Regions
#############################

#Australia & New Zealand
aust_newzealand <- happy_2015[which(happy_2015$region == "Australia and New Zealand"), ]

#Subsetting Western Europe
w_europe <- happy_2015[which(happy_2015$region == "Western Europe"), ]

#North America
n_america <- happy_2015[which(happy_2015$region == "North America"), ]

#Happiest regions Altogether
happy_regions <- rbind(aust_newzealand, w_europe, n_america)


#############################
#  Unhappiest Region
#############################
#Sub-Saharan Africa
sub_saharan_africa <- happy_2015[which(happy_2015$region == "Sub-Saharan Africa"), ]


#############################
# Other Regions
#############################
#Latin America & Caribbean
l_america <- happy_2015[which(happy_2015$region == "Latin America and Caribbean"), ]
#Middle East and Northern Africa
m_east_n_africa <- happy_2015[which(happy_2015$region == "Middle East and Northern Africa"), ]
#Central and Eastern Europe
central_easteu <- happy_2015[which(happy_2015$region == "Central and Eastern Europe"), ]
#Eastern Asia
east_asia <- happy_2015[which(happy_2015$region == "Eastern Asia"), ]
#Southern Asia
south_asia <- happy_2015[which(happy_2015$region == "Southern Asia"), ]

```

#Happiest Regions

*Distributions with Histogram
```{r, warning=FALSE}
library(ggplot2)
column_names <- colnames(num_hap_regions)
par(mfrow = c(5, 2))
for (i in 1:ncol(num_hap_regions)) {
  show(try(ggplot(num_hap_regions, aes(num_hap_regions[,i])) + 
        geom_histogram(fill="gray") + xlab(column_names[i])))}

```


#GDP per Capita & Countries in the Happiest Regions
```{r}
ggplot(happy_regions, aes(x=happy_regions$gdp_per_cpt, y=happy_regions$happiness_score))+ geom_point(aes(color = happy_regions$country)) +geom_smooth(method="lm") + xlab("GDP per Capita") + ylab("Happiness Score") 
```




```{r}
num_hap_regions <- happy_regions[, c("happiness_rank", "happiness_score", "std_error", "gdp_per_cpt", "family", "life_exp", "freedom", "trust_corruption", "generosity", "dystopia_residual")]
rquery.cormat(num_hap_regions)

```




